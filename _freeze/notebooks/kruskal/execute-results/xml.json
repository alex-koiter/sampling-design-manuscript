{
  "hash": "faea894945fdc65464ef738251dbf347",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Testing for differences between sites using three different sampling designs\nauthor: Alex Koiter\n---\n\n\n\n\n\n\n\n\n\n\n## Load Libraries\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(scales)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'scales'\n\nThe following object is masked from 'package:purrr':\n\n    discard\n\nThe following object is masked from 'package:readr':\n\n    col_factor\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(viridis)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoading required package: viridisLite\n\nAttaching package: 'viridis'\n\nThe following object is masked from 'package:scales':\n\n    viridis_pal\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(FSA)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n## FSA v0.9.5. See citation('FSA') if used in publication.\n## Run fishR() for related website and fishR('IFAR') for related book.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(patchwork)\n```\n:::\n\n\n\n\n\n\n\n\n\n\n## Load data\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\npsa <- read.csv(here::here(\"./notebooks/PSA_data.csv\")) %>%\n  rename(site = Site) %>%\n  select(site, sample_number, sampling_design, dx_50, specific_surface_area) %>%\n  filter(sampling_design != \"Fine scale\")  \n\nom <- read.csv(here::here(\"./notebooks/OM_data.csv\")) %>%\n  rename(site = Site, sampling_design = Sampling_Design, sample_number = Sample_Number) %>%\n  select(OM, site, sampling_design, sample_number) %>%\n  filter(sampling_design != \"Fine scale\") %>%\n  mutate(site = recode(site, Agricultural = \"Agriculture\")) \n\ngeo <- read.csv(here::here(\"./notebooks/Geochemistry analysis - Copy 2.csv\")) %>%\n  select(-X) %>%\n  rename(sampling_design = sample_design) %>%\n  filter(sampling_design != \"Fine scale\")  \n\ncolour <- read.csv(here::here(\"./notebooks/final results revised.csv\")) %>%\n  select(-X.1) %>%\n  rename(sampling_design = sample_design) %>%\n  filter(sampling_design != \"Fine scale\") \n```\n:::\n\n\n\n\n\n\n\n\n\n\n## Kruskal Wallis test\n### Colour\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nkruskal_colour <- colour %>%\n  pivot_longer(cols = X:B, names_to = \"Fingerprint\", values_to = \"value\") %>%\n  nest(data = c(-Fingerprint, - site)) %>%\n  mutate(k_test = map(data, ~kruskal.test(value ~ sampling_design, data = .))) %>%\n  mutate(p_value = map_dbl(k_test, ~ .$p.value)) %>%\n  select(site, Fingerprint,p_value)%>%\n  mutate(type = \"colour\")\n  \nkruskal_colour \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 30 × 4\n   site        Fingerprint    p_value type  \n   <chr>       <chr>            <dbl> <chr> \n 1 Agriculture X           0.0526     colour\n 2 Agriculture Y           0.0567     colour\n 3 Agriculture Z           0.530      colour\n 4 Agriculture x           0.0000370  colour\n 5 Agriculture y           0.00000552 colour\n 6 Agriculture u           0.0000173  colour\n 7 Agriculture v           0.00000769 colour\n 8 Agriculture L           0.0567     colour\n 9 Agriculture a           0.0000362  colour\n10 Agriculture b           0.0000104  colour\n# ℹ 20 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### Geochemistry\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nkruskal_geo <- geo %>%\n  pivot_longer(cols = Ag:Zr, names_to = \"Fingerprint\", values_to = \"value\") %>%\n  nest(data = c(-Fingerprint, - site)) %>%\n  mutate(k_test = map(data, ~kruskal.test(value ~ sampling_design, data = .))) %>%\n  mutate(p_value = map_dbl(k_test, ~ .$p.value)) %>%\n  select(site, Fingerprint,p_value) %>%\n  mutate(type = \"geochemistry\") %>%\n  filter(Fingerprint %in% c(\"Ag\", \"Al\", \"As\",\"B\",\"Ba\",\"Be\",\"Bi\",\"Ca\",\"Cd\",\"Ce\",\"Co\", \"Cr\", \"Cs\", \"Cu\", \"Fe\", \"Ga\", \"Hf\", \"Hg\", \"In\", \"K\", \"La\", \"Li\", \"Mg\", \"Mn\", \"Mo\", \"Nb\", \"Ni\", \"P\", \"Pb\", \"Rb\", \"S\", \"Sb\", \"Sc\", \"Se\", \"Sn\", \"Sr\", \"Te\", \"Th\", \"Tl\", \"U\", \"V\", \"Y\", \"Zn\", \"Zr\"))\nkruskal_geo \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 88 × 4\n   site   Fingerprint  p_value type        \n   <chr>  <chr>          <dbl> <chr>       \n 1 Forest Ag          0.00218  geochemistry\n 2 Forest Al          0.000205 geochemistry\n 3 Forest As          0.00640  geochemistry\n 4 Forest B           0.00786  geochemistry\n 5 Forest Ba          0.00558  geochemistry\n 6 Forest Be          0.000968 geochemistry\n 7 Forest Bi          0.000413 geochemistry\n 8 Forest Ca          0.000155 geochemistry\n 9 Forest Cd          0.000229 geochemistry\n10 Forest Ce          0.0661   geochemistry\n# ℹ 78 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### plotting\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplot_ele <- c(\"Ag\", \"Al\", \"As\", \"B\",  \"Ba\", \"Be\", \"Bi\", \"Ca\", \"Cd\", \"Ce\", \"Co\", \"Cr\", \"Cs\", \"Cu\", \"Fe\", \"Ga\", \"Hf\", \"Hg\", \"In\", \"K\",  \"La\", \"Li\")\n\nkruskal_p <- kruskal_colour %>%\n  bind_rows(kruskal_geo) %>%\n  mutate(start = 0) %>%\n  mutate(group = case_when(type == \"colour\" ~ \"Colour\",\n                           type == \"geochemistry\" & Fingerprint %in% plot_ele ~ \"Geochemistry (A-L)\",\n                           type == \"geochemistry\" & !Fingerprint %in% plot_ele ~ \"Geochemistry (M-Z)\")) %>%\n  mutate(\n    Fingerprint = fct_relevel(\n      Fingerprint,\n      c(\"R\", \"G\", \"B\", \"x\", \"y\", \"Y\", \"X\", \"Z\", \"L\", \"a\", \"b\", \"u\", \"v\", \"c\", \"h\")),\n    Fingerprint = fct_relevel(Fingerprint, c(\"Ag\", \"Al\", \"As\"), \n                              after = which(levels(Fingerprint) == \"B\") - 1),\n    Fingerprint = fct_relevel(Fingerprint, c(\"Mg\", \"Mn\", \"Mo\", \"Nb\", \"Ni\", \"P\", \"Pb\", \"Rb\", \"S\", \n                                             \"Sb\", \"Sc\", \"Se\", \"Sn\", \"Sr\", \"Te\", \"Th\", \"Tl\", \"U\", \"V\"), \n                              after = which(levels(Fingerprint) == \"Y\") - 1)) %>%\n  mutate(Fingerprint = fct_recode(\n    Fingerprint, \n    \"italic(`a*`)\" = \"a\", \"italic(`b*`)\" = \"b\", \"italic(`c*`)\" = \"c\", \"italic(`h*`)\" = \"h\", \n    \"italic(`u*`)\" = \"u\",  \"italic(`v*`)\" = \"v\"))\n\np1 <- ggplot(data = kruskal_p, aes(y = fct_relevel(Fingerprint, rev), x = p_value, colour = site)) +\n  #geom_point(position = position_dodge(width = 0.2)) +\n  geom_pointrange(aes(xmax= p_value, xmin = 0), position = position_dodge(width = 0.5), linewidth = 0.5) +\n  geom_vline(xintercept = 0.05, linetype = \"dashed\") +\n  theme_bw() +\n  scale_x_continuous(expand = c(0.01,0), limits = c(0,1)) +\n  scale_y_discrete(labels = label_parse()) +\n  scale_colour_viridis_d(begin = 0, end = 0.6) +\n  theme(legend.position = \"bottom\",\n        legend.title = element_blank()) +\n  labs(x = expression(paste(italic(\"p\"), \" value\")), y = \"Fingerprint\") +\n  facet_wrap(~group, scales = \"free_y\")\n\np1\n```\n\n::: {.cell-output-display}\n![](kruskal_files/figure-jats/unnamed-chunk-5-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Dunns test\nPost-hoc test\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nkw_geo_pass <- filter(kruskal_geo, p_value <0.05) %>%\n  rename(\"fingerprint\" = \"Fingerprint\")\n\ndunngeo <- geo %>%\n  pivot_longer(cols = Ag:Zr, names_to = \"fingerprint\", values_to = \"value\") %>%\n  semi_join(kw_geo_pass, by = c(\"fingerprint\", \"site\")) %>%\n  select(-sample_number) %>%\n  mutate(sampling_design = as.factor(sampling_design)) %>%\n  nest(data = c(-fingerprint, - site)) %>%\n  mutate(dunn_test = map(data, ~dunnTest(value ~ sampling_design, data = .,\n                                         method = \"bh\"))) %>%\n  mutate(p_value = map(dunn_test, ~ .$res)) %>%\n  unnest(p_value) %>%\n  mutate(type = \"Geochemistry\")\n\nkw_colour_pass <- filter(kruskal_colour, p_value <0.05) %>%\n  rename(\"fingerprint\" = \"Fingerprint\")\n\ndunncolour <- colour %>%\n  pivot_longer(cols = X:B, names_to = \"fingerprint\", values_to = \"value\") %>%\n  semi_join(kw_colour_pass, by = c(\"fingerprint\", \"site\")) %>%\n  select(-sample_number) %>%\n  mutate(sampling_design = as.factor(sampling_design)) %>%\n  nest(data = c(-fingerprint, - site)) %>%\n  mutate(dunn_test = map(data, ~dunnTest(value ~ sampling_design, data = .,\n                                         method = \"bh\"))) %>%\n  mutate(p_value = map(dunn_test, ~ .$res)) %>%\n  unnest(p_value) %>%\n  mutate(type = \"Colour\")\n```\n:::\n\n\n\n\n\n\n\n\n\n\n### Plotting\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndunn_p <- dunncolour %>%\n  bind_rows(dunngeo) %>%\n  mutate(start = 0) %>%\n  mutate(group = case_when(type == \"Colour\" ~ \"Colour\",\n                           type == \"Geochemistry\" & fingerprint %in% plot_ele ~ \"Geochemistry (A-L)\",\n                           type == \"Geochemistry\" & !fingerprint %in% plot_ele ~ \"Geochemistry (M-Z)\")) %>%\n  mutate(\n    fingerprint = fct_relevel(\n      fingerprint,\n      c(\"R\", \"G\", \"B\", \"x\", \"y\", \"Y\", \"X\", \"Z\", \"L\", \"a\", \"b\", \"u\", \"v\", \"c\", \"h\")),\n    fingerprint = fct_relevel(fingerprint, c(\"Ag\", \"Al\", \"As\"), \n                              after = which(levels(fingerprint) == \"B\") - 1),\n    fingerprint = fct_relevel(fingerprint, c(\"Mg\", \"Mo\", \"Nb\", \"Ni\", \"P\", \"Pb\", \"Rb\", \"S\", \n                                             \"Sb\", \"Sc\", \"Se\", \"Sn\", \"Sr\", \"Th\", \"Tl\", \"U\", \"V\"), \n                              after = which(levels(fingerprint) == \"Y\") - 1)) %>%\n  mutate(fingerprint = fct_recode(\n    fingerprint, \n    \"italic(`a*`)\" = \"a\", \"italic(`b*`)\" = \"b\", \"italic(`c*`)\" = \"c\", \"italic(`h*`)\" = \"h\", \n    \"italic(`u*`)\" = \"u\",  \"italic(`v*`)\" = \"v\"))\n\n\np2 <- ggplot(data = dunn_p, aes(y = fct_relevel(fingerprint, rev), x = P.adj, fill = Comparison)) +\n  #geom_point(position = position_dodge(width = 0.2)) +\n  geom_pointrange(aes(xmax= P.adj, xmin = 0), position = position_dodge(width = 0.5), linewidth = 0.2, shape = 21, stroke = 0.5) +\n  geom_vline(xintercept = 0.05, linetype = \"dashed\") +\n  theme_bw() +\n  scale_x_continuous(expand = c(0.01,0), limits = c(0,1)) +\n  scale_y_discrete(labels = label_parse()) +\n  scale_fill_viridis_d(begin = 0, end = 0.9, alpha = 0.8) +\n  theme(legend.position = \"bottom\",\n        legend.title = element_blank()) +\n  labs(x = expression(paste(\"Adjusted \", italic(\"p\"), \" value\")), y = \"Fingerprint\") +\n  facet_grid(group ~ site,scales = \"free\")\np2\n```\n\n::: {.cell-output-display}\n![](kruskal_files/figure-jats/unnamed-chunk-7-1.png)\n:::\n\n```{.r .cell-code .hidden}\np3 <- ggplot(data = filter(dunn_p, type == \"Colour\"), aes(y = fct_relevel(fingerprint, rev), x = P.adj, fill = Comparison)) +\n  #geom_point(position = position_dodge(width = 0.2)) +\n  geom_pointrange(aes(xmax= P.adj, xmin = 0), position = position_dodge(width = 0.5), linewidth = 0.2, shape = 21, stroke = 0.5) +\n  geom_vline(xintercept = 0.05, linetype = \"dashed\") +\n  theme_bw() +\n  scale_x_continuous(expand = c(0.01,0), limits = c(0,1)) +\n  scale_y_discrete(labels = label_parse()) +\n  scale_fill_viridis_d(begin = 0, end = 0.9, alpha = 0.8) +\n  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),\n        legend.title = element_blank()) +\n  labs(x = expression(paste(\"Adjusted \", italic(\"p\"), \" value\")), y = \"Fingerprint\") +\n  facet_wrap(~ site,scales = \"free\")\np3\n```\n\n::: {.cell-output-display}\n![](kruskal_files/figure-jats/unnamed-chunk-7-2.png)\n:::\n\n```{.r .cell-code .hidden}\np4 <- ggplot(data = filter(dunn_p, type == \"Geochemistry\", group == \"Geochemistry (A-L)\"), aes(y = fct_relevel(fingerprint, rev), x = P.adj, fill = Comparison)) +\n  #geom_point(position = position_dodge(width = 0.2)) +\n  geom_pointrange(aes(xmax= P.adj, xmin = 0), position = position_dodge(width = 0.5), linewidth = 0.2, shape = 21, stroke = 0.5) +\n  geom_vline(xintercept = 0.05, linetype = \"dashed\") +\n  theme_bw() +\n  scale_x_continuous(expand = c(0.01,0), limits = c(0,1)) +\n  scale_y_discrete(labels = label_parse()) +\n  scale_fill_viridis_d(begin = 0, end = 0.9, alpha = 0.8) +\n  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),\n        axis.title.x = element_blank(),\n        legend.title = element_blank()) +\n  labs(x = expression(paste(\"Adjusted \", italic(\"p\"), \" value\")), y = \"Fingerprint\") +\n  facet_wrap(~ site,scales = \"free\")\np4\n```\n\n::: {.cell-output-display}\n![](kruskal_files/figure-jats/unnamed-chunk-7-3.png)\n:::\n\n```{.r .cell-code .hidden}\np5 <- ggplot(data = filter(dunn_p, type == \"Geochemistry\", group != \"Geochemistry (A-L)\"), aes(y = fct_relevel(fingerprint, rev), x = P.adj, fill = Comparison)) +\n  #geom_point(position = position_dodge(width = 0.2)) +\n  geom_pointrange(aes(xmax= P.adj, xmin = 0), position = position_dodge(width = 0.5), linewidth = 0.2, shape = 21, stroke = 0.5) +\n  geom_vline(xintercept = 0.05, linetype = \"dashed\") +\n  theme_bw() +\n  scale_x_continuous(expand = c(0.01,0), limits = c(0,1)) +\n  scale_y_discrete(labels = label_parse()) +\n  scale_fill_viridis_d(begin = 0, end = 0.9, alpha = 0.8) +\n  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),\n        axis.title.y = element_blank(),\n        axis.title.x = element_blank(),\n        legend.title = element_blank()) +\n  labs(x = expression(paste(\"Adjusted \", italic(\"p\"), \" value\")), y = \"Fingerprint\") +\n  facet_wrap(~ site,scales = \"free\")\np5\n```\n\n::: {.cell-output-display}\n![](kruskal_files/figure-jats/unnamed-chunk-7-4.png)\n:::\n:::\n\n::: {#cell-fig-dunns-test .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-dunns-test\n#| fig-cap: \"Results for the pair-wise Dunn’s post-hoc test to determine differences in fingerprint properties between the three sampling designs for each site. Dashed line represents an α value of 0.05. Fingerprints that showed no significant differences (p value > 0.05) following the Kruskal Wallis test are not included.\"\np6 <- p4 + p5 + p3 + guide_area() + \n  plot_layout(guides = 'collect') + plot_layout(axis_titles = \"collect\")\np6\n```\n\n::: {.cell-output-display}\n![Results for the pair-wise Dunn’s post-hoc test to determine differences in fingerprint properties between the three sampling designs for each site. Dashed line represents an α value of 0.05. Fingerprints that showed no significant differences (p value > 0.05) following the Kruskal Wallis test are not included.](kruskal_files/figure-jats/fig-dunns-test-1.png){#fig-dunns-test}\n:::\n:::",
    "supporting": [
      "kruskal_files/figure-jats"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}