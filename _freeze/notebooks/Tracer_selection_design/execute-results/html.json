{
  "hash": "96e17b8e5e913715e16302d3715b59e4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Tracer selection using design specific mixtures\nauthor: Alex Koiter\n---\n\n\n\n\n\n  \n## Load Libraries\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(ggfortify)\nlibrary(patchwork)\n```\n:::\n\n\n\n\n\n\n## % classified function\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nclassify <- function(data, model, by = \"site\", type = \"percent\") {\n  if(type == \"count\") x <- table(as.data.frame(data)[,\"site\"], model$class)\n  if(type == \"percent\") x <- diag(prop.table(table(as.data.frame(data)[,\"site\"], model$class), 1)) * 100\n  x\n}\n```\n:::\n\n\n\n\n\n\n## Load in data\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ngeo_results <- read.csv(here::here(\"./notebooks/Geochemistry analysis - Copy 2.csv\")) %>%\n  pivot_longer(cols = Ag:Zr, names_to = \"Fingerprint\", values_to = \"value\") %>%\n  filter(Fingerprint %in% c(\"Ag\", \"Al\", \"As\",\"B\",\"Ba\",\"Be\",\"Bi\",\"Ca\",\"Cd\",\"Ce\",\"Co\", \"Cr\", \"Cs\", \"Cu\", \"Fe\", \"Ga\", \"Hf\", \"Hg\", \"In\", \"K\", \"La\", \"Li\", \"Mg\", \"Mn\", \"Mo\", \"Nb\", \"Ni\", \"P\", \"Pb\", \"Rb\", \"S\", \"Sb\", \"Sc\", \"Se\", \"Sn\", \"Sr\", \"Te\", \"Th\", \"Tl\", \"U\", \"V\", \"Y\", \"Zn\", \"Zr\")) %>% # excludes fingerprints that are below level of detection\n  dplyr::select(-X) %>% # don't need this column\n  filter(sample_design %in% c(\"Grid\", \"Transect\", \"Likely to erode\")) \n\ncol_results <- read.csv(here::here(\"./notebooks/final results revised.csv\")) %>%\n  pivot_longer(cols = X:B, names_to = \"Fingerprint\", values_to = \"value\") %>%\n  dplyr::select(-X.1) %>% # don't need this column\n  filter(sample_design %in% c(\"Grid\", \"Transect\", \"Likely to erode\")) %>%\n  mutate(Fingerprint = paste0(Fingerprint, \"_col\")) # appended _col as some of the colour coefficients have the same id eg Boron = B and Blue also = B\n\nf_order <- c(\"Ag\", \"Al\", \"As\",\"B\",\"Ba\",\"Be\",\"Bi\",\"Ca\",\"Cd\",\"Ce\",\"Co\", \"Cr\", \"Cs\", \"Cu\", \"Fe\", \"Ga\", \"Hf\", \"Hg\", \"In\", \"K\", \"La\", \"Li\", \"Mg\", \"Mn\", \"Mo\", \"Nb\", \"Ni\", \"P\", \"Pb\", \"Rb\", \"S\", \"Sb\", \"Sc\", \"Se\", \"Sn\", \"Sr\", \"Te\", \"Th\", \"Tl\", \"U\", \"V\", \"Y\", \"Zn\", \"Zr\", \"R_col\", \"G_col\", \"B_col\", \"x_col\", \"y_col\", \"Y_col\", \"X_col\", \"Z_col\",\"L_col\", \"a_col\", \"b_col\", \"u_col\", \"v_col\", \"c_col\", \"h_col\")\n\n# Bind data sets\nresults <- geo_results %>%\n  bind_rows(col_results) \n```\n:::\n\n\n\n\n\n\n## Virtual mixtures\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nproportions <- seq(0, 1, 0.05)\n\nmixtures <- results %>%\n  group_by(Fingerprint, site, sample_design) %>%\n  summarise(avg =  mean(value)) %>%\n  pivot_wider(names_from = site, values_from = avg) %>%\n  group_by(sample_design) %>%\n  mutate(mix_ag = map(Agriculture, ~.x * (1 - proportions)),\n         mix_forest = map(Forest, ~.x * proportions)) %>%\n  group_by(Fingerprint, Agriculture, Forest, sample_design) %>%\n  summarize(mix = map2(mix_ag, mix_forest, ~data.frame(mix = .x + .y, prop_forest = proportions))) %>%\n  unnest(mix) %>%\n  pivot_wider(id_cols = c(\"Fingerprint\", \"Agriculture\", \"Forest\", \"sample_design\"), names_from = prop_forest, values_from = mix) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'Fingerprint', 'site'. You can override\nusing the `.groups` argument.\n`summarise()` has grouped output by 'Fingerprint', 'Agriculture', 'Forest'. You\ncan override using the `.groups` argument.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Range test\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nrange <- results %>%\n  group_by(site, sample_design, Fingerprint) %>%\n  summarise(upper_lim = quantile(value, 0.75),\n            lower_lim = quantile(value, 0.25)) %>%\n  group_by(Fingerprint, sample_design) %>%\n  summarise(lower_lim = min(lower_lim),\n            upper_lim = max(upper_lim)) %>%\n  ungroup() %>%\n  left_join(mixtures) %>%\n  dplyr::select(-c(Agriculture, Forest)) %>%\n  group_by(Fingerprint, sample_design) %>%\n  mutate(pass = all(round(`0`:`1`, 5) >= round(lower_lim, 5)) & all(round(`0`:`1`, 5) <= round(upper_lim, 5)))  ## rounding as differences as small as 10^-18 were being removed otherwise\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'site', 'sample_design'. You can override\nusing the `.groups` argument.\n`summarise()` has grouped output by 'Fingerprint'. You can override using the\n`.groups` argument.\nJoining with `by = join_by(Fingerprint, sample_design)`\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ngrid_range <- filter(range, pass == TRUE , sample_design == \"Grid\") %>%\n  arrange(factor(Fingerprint, levels = f_order)) %>%\n  pull(Fingerprint)\n\ntransect_range <- filter(range, pass == TRUE , sample_design == \"Transect\") %>%\n  arrange(factor(Fingerprint, levels = f_order)) %>%\n  pull(Fingerprint)\n\nlikely_range <- filter(range, pass == TRUE , sample_design == \"Likely to erode\") %>%\n  arrange(factor(Fingerprint, levels = f_order)) %>%\n  pull(Fingerprint)\n\nrange_results <- filter(range, pass == TRUE) %>%\n  dplyr::select(Fingerprint, sample_design)\n```\n:::\n\n\n\n\n\n\n## Mann-W test\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nwilcox_test <- range_results %>%\n  inner_join(results) %>%\n  nest(data = c(-sample_design, -Fingerprint)) %>%\n  mutate(test = map(data, ~wilcox.test(value ~ site, data = ., exact = FALSE))) %>%\n  mutate(p_value = map_dbl(test, ~ .$p.value),\n         statistic =  map_dbl(test, ~ .$statistic))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nJoining with `by = join_by(Fingerprint, sample_design)`\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ngrid_wilcox <- filter(wilcox_test, p_value < 0.01 , sample_design == \"Grid\") %>%\n  arrange(factor(Fingerprint, levels = f_order))\ngrid_wilcox\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 49 × 6\n# Groups:   Fingerprint, sample_design [49]\n   Fingerprint sample_design data              test     p_value statistic\n   <chr>       <chr>         <list>            <list>     <dbl>     <dbl>\n 1 Ag          Grid          <tibble [98 × 3]> <htest> 8.43e-15     2282.\n 2 Al          Grid          <tibble [98 × 3]> <htest> 1.48e-17     2401 \n 3 As          Grid          <tibble [98 × 3]> <htest> 8.37e-17     2372.\n 4 Be          Grid          <tibble [98 × 3]> <htest> 1.47e-17     2401 \n 5 Bi          Grid          <tibble [98 × 3]> <htest> 2.85e-16     2349 \n 6 Ca          Grid          <tibble [98 × 3]> <htest> 8.60e- 8     1954.\n 7 Cd          Grid          <tibble [98 × 3]> <htest> 1.54e- 7     1939 \n 8 Ce          Grid          <tibble [98 × 3]> <htest> 1.28e- 8     2002.\n 9 Co          Grid          <tibble [98 × 3]> <htest> 3.35e-11     2134.\n10 Cr          Grid          <tibble [98 × 3]> <htest> 1.16e-17     2400 \n# ℹ 39 more rows\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\npull(grid_wilcox, Fingerprint)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Ag\"    \"Al\"    \"As\"    \"Be\"    \"Bi\"    \"Ca\"    \"Cd\"    \"Ce\"    \"Co\"   \n[10] \"Cr\"    \"Cs\"    \"Cu\"    \"Fe\"    \"Ga\"    \"Hf\"    \"Hg\"    \"In\"    \"K\"    \n[19] \"La\"    \"Li\"    \"Mg\"    \"Nb\"    \"Ni\"    \"Rb\"    \"S\"     \"Sb\"    \"Sc\"   \n[28] \"Se\"    \"Sn\"    \"Sr\"    \"Te\"    \"Th\"    \"U\"     \"V\"     \"Y\"     \"Zr\"   \n[37] \"G_col\" \"B_col\" \"x_col\" \"Y_col\" \"X_col\" \"Z_col\" \"L_col\" \"a_col\" \"b_col\"\n[46] \"u_col\" \"v_col\" \"c_col\" \"h_col\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ntransect_wilcox <- filter(wilcox_test, p_value < 0.01 , sample_design == \"Transect\") %>%\n  arrange(factor(Fingerprint, levels = f_order))\ntransect_wilcox\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 38 × 6\n# Groups:   Fingerprint, sample_design [38]\n   Fingerprint sample_design data              test       p_value statistic\n   <chr>       <chr>         <list>            <list>       <dbl>     <dbl>\n 1 Ag          Transect      <tibble [28 × 3]> <htest> 0.000319        176 \n 2 Al          Transect      <tibble [28 × 3]> <htest> 0.00000734      196 \n 3 As          Transect      <tibble [28 × 3]> <htest> 0.00000920      195 \n 4 B           Transect      <tibble [28 × 3]> <htest> 0.00000106      196 \n 5 Be          Transect      <tibble [28 × 3]> <htest> 0.00000734      196 \n 6 Bi          Transect      <tibble [28 × 3]> <htest> 0.0000229       190 \n 7 Ca          Transect      <tibble [28 × 3]> <htest> 0.000310        177 \n 8 Cd          Transect      <tibble [28 × 3]> <htest> 0.00930         155 \n 9 Ce          Transect      <tibble [28 × 3]> <htest> 0.00152         168.\n10 Co          Transect      <tibble [28 × 3]> <htest> 0.000433        175 \n# ℹ 28 more rows\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\npull(transect_wilcox, Fingerprint)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Ag\"    \"Al\"    \"As\"    \"B\"     \"Be\"    \"Bi\"    \"Ca\"    \"Cd\"    \"Ce\"   \n[10] \"Co\"    \"Cr\"    \"Cs\"    \"Cu\"    \"Fe\"    \"Ga\"    \"In\"    \"La\"    \"Li\"   \n[19] \"Nb\"    \"Ni\"    \"S\"     \"Sb\"    \"Sc\"    \"Se\"    \"Sn\"    \"Sr\"    \"Te\"   \n[28] \"U\"     \"V\"     \"Y\"     \"B_col\" \"x_col\" \"Z_col\" \"a_col\" \"b_col\" \"u_col\"\n[37] \"c_col\" \"h_col\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlikely_wilcox <- filter(wilcox_test, p_value < 0.01 , sample_design == \"Likely to erode\") %>%\n  arrange(factor(Fingerprint, levels = f_order))\nlikely_wilcox\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 48 × 6\n# Groups:   Fingerprint, sample_design [48]\n   Fingerprint sample_design   data              test     p_value statistic\n   <chr>       <chr>           <list>            <list>     <dbl>     <dbl>\n 1 Ag          Likely to erode <tibble [16 × 3]> <htest> 0.000612        64\n 2 Al          Likely to erode <tibble [16 × 3]> <htest> 0.000923        64\n 3 As          Likely to erode <tibble [16 × 3]> <htest> 0.000931        64\n 4 B           Likely to erode <tibble [16 × 3]> <htest> 0.000325        64\n 5 Ba          Likely to erode <tibble [16 × 3]> <htest> 0.000830         0\n 6 Be          Likely to erode <tibble [16 × 3]> <htest> 0.000923        64\n 7 Bi          Likely to erode <tibble [16 × 3]> <htest> 0.000830        64\n 8 Ca          Likely to erode <tibble [16 × 3]> <htest> 0.00741          6\n 9 Cd          Likely to erode <tibble [16 × 3]> <htest> 0.000923        64\n10 Co          Likely to erode <tibble [16 × 3]> <htest> 0.00710         58\n# ℹ 38 more rows\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\npull(likely_wilcox, Fingerprint)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Ag\"    \"Al\"    \"As\"    \"B\"     \"Ba\"    \"Be\"    \"Bi\"    \"Ca\"    \"Cd\"   \n[10] \"Co\"    \"Cr\"    \"Cs\"    \"Cu\"    \"Fe\"    \"Ga\"    \"Hg\"    \"In\"    \"K\"    \n[19] \"Li\"    \"Mg\"    \"Mo\"    \"Nb\"    \"Ni\"    \"Pb\"    \"Rb\"    \"Sb\"    \"Sc\"   \n[28] \"Se\"    \"Sn\"    \"Sr\"    \"Th\"    \"Tl\"    \"U\"     \"V\"     \"Y\"     \"Zn\"   \n[37] \"R_col\" \"G_col\" \"x_col\" \"y_col\" \"Y_col\" \"X_col\" \"L_col\" \"a_col\" \"b_col\"\n[46] \"u_col\" \"v_col\" \"c_col\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nwilcox_results <- filter(wilcox_test, p_value < 0.01) %>%\n  dplyr::select(Fingerprint, sample_design)\n```\n:::\n\n\n\n\n\n\n## DFA\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndfa_test <- wilcox_results %>%\n  inner_join(results) %>%\n  ungroup() %>%\n  nest(data = c(-sample_design)) %>%\n  mutate(newdata = map(data, ~pivot_wider(., names_from = Fingerprint, values_from = value))) %>%\n  mutate(newdata = map(newdata, ~dplyr::select(., -sample_number))) %>%\n  mutate(test = map(newdata, ~ klaR::greedy.wilks(site ~ ., data =. , niveau = 0.1, na.action = \"na.omit\"))) %>%\n  mutate(Fingerprint = map(test, ~ .$results$vars)) %>%\n  mutate(wilks = map(test, ~.x$results$Wilks.lambda))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nJoining with `by = join_by(Fingerprint, sample_design)`\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ngrid_dfa <- dfa_test %>%\n  unnest(Fingerprint) %>%\n  filter(sample_design == \"Grid\") %>%\n  pull(Fingerprint)\ngrid_dfa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Li\"    \"a_col\" \"Fe\"    \"Co\"    \"Hg\"    \"x_col\" \"Cs\"    \"La\"    \"Ni\"   \n[10] \"Nb\"    \"h_col\" \"b_col\" \"Rb\"    \"Ca\"    \"Sr\"    \"c_col\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ntransect_dfa <- \n  dfa_test %>%\n  unnest(Fingerprint) %>%\n  filter(sample_design == \"Transect\") %>%\n  pull(Fingerprint)\ntransect_dfa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Li\" \"Cu\" \"Ca\" \"Be\" \"Co\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlikely_dfa <- \n  dfa_test %>%\n  unnest(Fingerprint) %>%\n  filter(sample_design == \"Likely to erode\") %>%\n  pull(Fingerprint)\nlikely_dfa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Li\" \"Sc\" \"Sn\"\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n## PCA\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndf_grid <- results %>% \n  filter(sample_design == \"Grid\") %>%\n  filter(Fingerprint %in% grid_dfa) %>%\n  pivot_wider(names_from = Fingerprint, values_from = value) %>%\n  dplyr::select(-sample_design, -sample_number)\n\ndf_transect<- results %>%\n  filter(sample_design == \"Transect\") %>%\n  filter(Fingerprint %in% transect_dfa) %>%\n  pivot_wider(names_from = Fingerprint, values_from = value) %>%\n  dplyr::select(-sample_design, -sample_number)\n\ndf_likely <- results %>%\n  filter(sample_design == \"Likely to erode\") %>%\n  filter(Fingerprint %in% likely_dfa) %>%\n  pivot_wider(names_from = Fingerprint, values_from = value) %>%\n  dplyr::select(-sample_design, -sample_number)\n\npca_grid <- prcomp(select(df_grid, 2:ncol(df_grid)), scale. = TRUE)\n\nautoplot(pca_grid)\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\np1 <- autoplot(pca_grid, \n               data = df_grid, \n               colour = 'site',\n               frame = TRUE, \n               frame.type = 'norm') +\n  theme_bw() +\n  scale_colour_viridis_d(begin = 0, end = 0.6) +\n  scale_fill_viridis_d(begin = 0, end = 0.6) +\n  theme(legend.title = element_blank()) +\n  labs(title = \"Grid\")\np1\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\npca_transect <- prcomp(select(df_transect, 2:ncol(df_transect)) , scale. = TRUE)\nautoplot(pca_transect)\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-8-3.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\np2 <- autoplot(pca_transect, \n               data = df_transect, \n               colour = 'site', \n               frame = TRUE, \n               frame.type = 'norm') +\n  theme_bw() +\n  scale_colour_viridis_d(begin = 0, end = 0.6) +\n  scale_fill_viridis_d(begin = 0, end = 0.6) +\n  theme(legend.title = element_blank()) +\n  labs(title = \"Transect\")\np2\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-8-4.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\npca_likely <- prcomp(select(df_likely, 2:ncol(df_likely)) , scale. = TRUE)\nautoplot(pca_likely)\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-8-5.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\np3 <- autoplot(pca_likely, \n               data = df_likely, \n               colour = 'site', \n               frame = TRUE, \n               frame.type = 'norm') +\n  theme_bw() +\n  scale_colour_viridis_d(begin = 0, end = 0.6) +\n  scale_fill_viridis_d(begin = 0, end = 0.6) +\n  theme(legend.title = element_blank())+\n  labs(title = \"Likely to erode\")\np3\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-8-6.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\np4 <- p1 + p2 + p3+\n  plot_layout(guides = 'collect') & theme(legend.position = \"bottom\")\np4\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-8-7.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\n#ggsave(filename = \"Figures R1/design_pca.png\", plot = p4, width = 174, height = 100, units = \"mm\", dpi = 600)\n```\n:::\n\n\n\n\n\n\n## Assess accuracy of discrimination \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ngrid.lda <- MASS::lda(site ~ ., data = df_grid, na.action = \"na.omit\", CV = T)\ntransect.lda <- MASS::lda(site ~ ., data = df_transect, na.action = \"na.omit\", CV = T)\nlikely.lda <- MASS::lda(site ~ ., data = df_likely, na.action = \"na.omit\", CV = T)\n\n#' ## percent correct for each category \n#' ### Grid \ntable(as.data.frame(df_grid)[,\"site\"], grid.lda$class)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             \n              Agriculture Forest\n  Agriculture          49      0\n  Forest                0     49\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndiag(prop.table(table(as.data.frame(df_grid)[,\"site\"], grid.lda$class), 1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAgriculture      Forest \n          1           1 \n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#' ### Transect\ntable(as.data.frame(df_transect)[,\"site\"], transect.lda$class)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             \n              Agriculture Forest\n  Agriculture          14      0\n  Forest                0     14\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndiag(prop.table(table(as.data.frame(df_transect)[,\"site\"], transect.lda$class), 1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAgriculture      Forest \n          1           1 \n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#' ### Likely to erode\ntable(as.data.frame(df_likely)[,\"site\"], likely.lda$class)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             \n              Agriculture Forest\n  Agriculture           8      0\n  Forest                0      8\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndiag(prop.table(table(as.data.frame(df_likely)[,\"site\"], likely.lda$class), 1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAgriculture      Forest \n          1           1 \n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#' ##  total percent correct  \n#' ### Grid \nsum(diag(prop.table(table(as.data.frame(df_grid)[,\"site\"], grid.lda$class))))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#' ### Transect\nsum(diag(prop.table(table(as.data.frame(df_transect)[,\"site\"], transect.lda$class))))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#' ### Likely to erode\nsum(diag(prop.table(table(as.data.frame(df_likely)[,\"site\"], likely.lda$class))))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Percent Classified correctly and Wilks Lamda\n### Grid design\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ngrid_classify <- tibble(n = 1:length(grid_dfa),\n            params = map(n, ~grid_dfa[1:.x])) %>%\n  mutate(params = map_chr(params, ~paste0(.x, collapse = \" + \")),\n         f = map(params, ~as.formula(paste0(\"site ~ \", .x))),\n         m = map(f, ~MASS::lda(.x, data = df_grid, na.action = \"na.omit\", CV = TRUE)),\n         c = map_df(m, ~classify(data = df_grid, model = .x))) %>%\n  select(-n, -f, -m) %>%\n  mutate(wilks = dfa_test$wilks[dfa_test$sample_design == \"Grid\"][[1]])\n\ngrid_classify\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 16 × 3\n   params                                                  c$Agriculture   wilks\n   <chr>                                                           <dbl>   <dbl>\n 1 Li                                                                100 0.0620 \n 2 Li + a_col                                                        100 0.0441 \n 3 Li + a_col + Fe                                                   100 0.0276 \n 4 Li + a_col + Fe + Co                                              100 0.0233 \n 5 Li + a_col + Fe + Co + Hg                                         100 0.0217 \n 6 Li + a_col + Fe + Co + Hg + x_col                                 100 0.0188 \n 7 Li + a_col + Fe + Co + Hg + x_col + Cs                            100 0.0178 \n 8 Li + a_col + Fe + Co + Hg + x_col + Cs + La                       100 0.0145 \n 9 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni                  100 0.0134 \n10 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni + Nb             100 0.0128 \n11 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni + Nb …           100 0.0123 \n12 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni + Nb …           100 0.0114 \n13 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni + Nb …           100 0.0110 \n14 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni + Nb …           100 0.00970\n15 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni + Nb …           100 0.00925\n16 Li + a_col + Fe + Co + Hg + x_col + Cs + La + Ni + Nb …           100 0.00886\n# ℹ 1 more variable: c$Forest <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n\n### Transect design\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ntransect_classify <- tibble(n = 1:length(transect_dfa),\n                        params = map(n, ~transect_dfa[1:.x])) %>%\n  mutate(params = map_chr(params, ~paste0(.x, collapse = \" + \")),\n         f = map(params, ~as.formula(paste0(\"site ~ \", .x))),\n         m = map(f, ~MASS::lda(.x, data = df_transect, na.action = \"na.omit\", CV = TRUE)),\n         c = map_df(m, ~classify(data = df_transect, model = .x))) %>%\n  select(-n, -f, -m) %>%\n  mutate(wilks = dfa_test$wilks[dfa_test$sample_design == \"Transect\"][[1]])\n\ntransect_classify\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 3\n  params                 c$Agriculture $Forest  wilks\n  <chr>                          <dbl>   <dbl>  <dbl>\n1 Li                               100     100 0.0479\n2 Li + Cu                          100     100 0.0345\n3 Li + Cu + Ca                     100     100 0.0262\n4 Li + Cu + Ca + Be                100     100 0.0208\n5 Li + Cu + Ca + Be + Co           100     100 0.0162\n```\n\n\n:::\n:::\n\n\n\n\n\n\n### Likely to erode design\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlikely_classify <- tibble(n = 1:length(likely_dfa),\n                            params = map(n, ~likely_dfa[1:.x])) %>%\n  mutate(params = map_chr(params, ~paste0(.x, collapse = \" + \")),\n         f = map(params, ~as.formula(paste0(\"site ~ \", .x))),\n         m = map(f, ~MASS::lda(.x, data = df_likely, na.action = \"na.omit\", CV = TRUE)),\n         c = map_df(m, ~classify(data = df_likely, model = .x))) %>%\n  select(-n, -f, -m) %>%\n  mutate(wilks = dfa_test$wilks[dfa_test$sample_design == \"Likely to erode\"][[1]])\n\nlikely_classify\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  params       c$Agriculture $Forest   wilks\n  <chr>                <dbl>   <dbl>   <dbl>\n1 Li                     100     100 0.0237 \n2 Li + Sc                100     100 0.00835\n3 Li + Sc + Sn           100     100 0.00611\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Plotting\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplotting3 <- results %>%\n  filter(Fingerprint %in% unique(c(grid_dfa, likely_dfa, transect_dfa))) %>%\n  group_by(Fingerprint, sample_design, site) %>%\n  summarise(avg = mean(value),\n            sd = sd(value)) %>%\n  rename(\"Source\" = site) %>%\n  mutate(Fingerprint = as.factor(Fingerprint)) %>%\n  mutate(Fingerprint = fct_recode(Fingerprint, \"italic(`a*`)\" = \"a_col\", \"italic(`b*`)\" = \"b_col\", \"italic(`c*`)\" = \"c_col\", \"italic(`h*`)\" = \"h_col\", \"italic(`x*`)\" = \"x_col\", \"`Ca (%)`\" = \"Ca\", \"`Fe (%)`\" = \"Fe\"))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'Fingerprint', 'sample_design'. You can\noverride using the `.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\np1 <- ggplot(data = plotting3, aes(x = sample_design, y = avg, colour = Source)) +\n  geom_point(position = position_dodge(width = 0.5)) +\n  geom_errorbar(data = plotting3, aes(ymax = avg + sd, ymin = avg -sd, x = sample_design), position = position_dodge(width = 0.5), width = 0.5) +\n  scale_colour_viridis_d(begin = 0, end = 0.6) +\n  theme_bw() +\n  labs(y = \"Concentation (ppm) or value\") +\n  theme(axis.title.x = element_blank(),\n        axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),\n        legend.position = \"bottom\",\n        legend.title = element_blank()) +\n  facet_wrap(~Fingerprint, ncol = 4, scales = \"free_y\", labeller = \"label_parsed\")\n\np1\n```\n\n::: {.cell-output-display}\n![](Tracer_selection_design_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\n#ggsave(plot = p1, filename = \"Figures R1/design_means_sds.png\", height = 150, width = 175, units = \"mm\", dpi = 600)\n```\n:::\n",
    "supporting": [
      "Tracer_selection_design_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}